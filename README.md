# Сервис сокращения ссылок на Go

## Описание проекта
Этот проект представляет собой сервис для сокращения URL-адресов с аутентификацией пользователей и статистикой переходов. Реализован на языке Go с использованием принципов чистой архитектуры. Сервис предоставляет REST API для создания коротких ссылок, управления ими и просмотра статистики переходов.

## Технические особенности
- Хранение данных в PostgreSQL
- Поддержка graceful shutdown
- Логирование запросов
- Юнит-тесты для основных методов
- Использование принципов чистой архитектуры
- Docker-контейнеризация 
- JWT-аутентификация
- Валидация входящих данных
- Конкурентная обработка событий статистики

## Функциональность

### Управление пользователями
- Регистрация новых пользователей
- Аутентификация (получение JWT токена)
- Авторизация запросов

### Управление ссылками
- Создание коротких ссылок
- Обновление ссылок 
- Удаление ссылок 
- Получение списка всех ссылок
- Перенаправление по короткой ссылке

### Статистика
- Просмотр статистики переходов
- Группировка статистики по дням/месяцам
- Фильтрация по датам

## API (REST)
Базовый URL: `http://localhost:8081`

### Аутентификация

#### Регистрация пользователя
```http
POST /auth/register
Content-Type: application/json

{
  "name": "Иван",
  "email": "ivan@example.com",
  "password": "Pass123"
}
```

#### Вход в систему
```http
POST /auth/login
Content-Type: application/json

{
  "email": "ivan@example.com",
  "password": "Pass123"
}
```

### Работа со ссылками

#### Создание короткой ссылки
```http
POST /link
Authorization: Bearer <JWT_TOKEN>
Content-Type: application/json

{
  "url": "https://example.com/very/long/url"
}
```

#### Обновление ссылки
```http
PATCH /link/{id}
Authorization: Bearer <JWT_TOKEN>
Content-Type: application/json

{
  "url": "https://new-url.com",
  "hash": "newHash123"
}
```

#### Удаление ссылки
```http
DELETE /link/{id}
Authorization: Bearer <JWT_TOKEN>
```

#### Получение всех ссылок
```http
GET /link
Authorization: Bearer <JWT_TOKEN>
```

#### Переход по короткой ссылке
```http
GET /{hash}
```

### Статистика

#### Получение статистики
```http
GET /stat
Authorization: Bearer <JWT_TOKEN>
```

Query параметры:
- `from`: 2025-06-01 (обязательный)
- `to`: 2025-06-15 (обязательный)
- `by`: day|month (обязательный)

## Примеры ответов

### Успешная аутентификация
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

### Созданная ссылка
```json
{
  "id": 1,
  "url": "https://example.com/very/long/url",
  "hash": "aBcD12",
  "created_at": "2025-06-15T10:30:00Z"
}
```

### Статистика переходов
```json
[
  {
    "period": "2025-06-10",
    "sum": 42
  },
  {
    "period": "2025-06-11",
    "sum": 31
  }
]
```

## Обработка ошибок
- `400 Bad Request` — ошибки валидации
- `401 Unauthorized` — неверные учетные данные
- `500 Internal Server Error` — внутренняя ошибка сервера

## Структура данных

### Пользователь
- **id** (uint) - уникальный идентификатор
- **email** (string) - email пользователя
- **password** (string) - хешированный пароль
- **name** (string) - имя пользователя

### Ссылка
- **id** (uint) - уникальный идентификатор
- **url** (string) - оригинальный URL
- **hash** (string) - короткий идентификатор

### Статистика
- **id** (uint) - уникальный идентификатор
- **link_id** (uint) - идентификатор ссылки
- **clicks** (int) - количество переходов
- **date** (date) - дата

## Валидация

### Для пользователя:
- Email должен быть валидным
- Пароль не должен быть пустым
- Имя не должно быть пустым

### Для ссылок:
- URL должен быть абсолютным (http/https)
- URL должен соответствовать формату URL
- Hash должен быть уникальным

### Безопасность:
- Пароли хранятся в хешированном виде (bcrypt)
- Все запросы (кроме /auth/* и /{hash}) требуют JWT-аутентификации
